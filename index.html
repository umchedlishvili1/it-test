<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <title>Duty Manager - Professional Admin</title>
    <style>
        :root { 
            --dark: #0f172a; --blue: #0ea5e9; --green: #16a34a; --viber: #7360f2;
            --west: #f59e0b; --east: #ea580c; --cc: #6366f1; --bg: #f1f5f9;
            --text-main: #1e293b;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); overflow: hidden; color: var(--text-main); }
        
        #sidebar { width: 380px; background: var(--dark); color: white; padding: 20px; overflow-y: auto; flex-shrink: 0; border-right: 1px solid rgba(255,255,255,0.1); }
        .box { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        h3 { color: var(--blue); font-size: 11px; text-transform: uppercase; margin: 0 0 12px 0; letter-spacing: 1.5px; }
        input, textarea, select { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.9); color: #000; box-sizing: border-box; outline: none; font-weight: 600; }
        
        #main { flex-grow: 1; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        #canvas { width: 100%; max-width: 620px; background: white; border-radius: 40px; padding: 30px; box-shadow: 0 25px 50px rgba(0,0,0,0.1); }
        
        .live-banner { background: linear-gradient(135deg, #1e293b, #0f172a); color: white; padding: 25px; border-radius: 30px; text-align: center; margin-bottom: 20px; }
        .big-date { font-size: 40px; font-weight: 900; color: var(--blue); line-height: 1.2; margin-bottom: 10px; }
        .live-phone { font-size: 26px; color: var(--green); font-weight: 800; text-decoration: none; display: block; margin: 8px 0; }

        .priority-box { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .p-card { padding: 12px; border-radius: 20px; color: white; text-align: center; font-size: 12px; }
        .p-card b { display: block; font-size: 14px; margin-top: 5px; }

        #customInfoDisplay { background: #f8fafc; padding: 15px; border-radius: 20px; margin-bottom: 20px; border-left: 5px solid var(--blue); white-space: pre-wrap; display: none; color: #1e293b; font-weight: 600; }

        .row { padding: 15px 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .today-row { background: #f0f9ff; border-left: 6px solid var(--blue); border-radius: 0 15px 15px 0; }
        .sel-duty { border: 2px solid #cbd5e1; padding: 8px; border-radius: 10px; font-weight: 800; width: 160px; background: #fff; color: #0f172a; }
        
        .btn-act { text-decoration: none; color: white; padding: 8px 12px; border-radius: 8px; font-size: 10px; font-weight: 800; display: inline-block; }
        .btn-gen { background: var(--viber); width: 100%; padding: 12px; border: none; border-radius: 10px; color: white; font-weight: 800; cursor: pointer; }
        .btn-export { background: var(--green); color: white; width: 620px; padding: 18px; border-radius: 20px; border: none; font-weight: 800; cursor: pointer; margin-top: 15px; font-size: 16px; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="box">
        <h3>ğŸ“… áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ˜</h3>
        <input type="month" id="workMonth">
        <div style="display:flex; gap:10px;">
            <input type="number" id="startDay" placeholder="áƒ“áƒáƒœ" value="1">
            <input type="number" id="endDay" placeholder="áƒ›áƒ“áƒ”" value="31">
        </div>
        <button class="btn-gen" onclick="smartDistribute()">ğŸ”„ áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ</button>
    </div>

    <div class="box">
        <h3>ğŸ“Œ áƒ¨áƒ”áƒœáƒ˜áƒ¨áƒ•áƒœáƒ</h3>
        <textarea id="infoText" placeholder="áƒ©áƒáƒ¬áƒ”áƒ áƒ”áƒ— áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜..." oninput="updateCustomInfo()"></textarea>
        <input type="color" id="infoColor" value="#1e293b" onchange="updateCustomInfo()">
    </div>

    <div class="box">
        <h3>ğŸ‘¥ áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜</h3>
        <input type="text" id="addName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ’áƒ•áƒáƒ áƒ˜">
        <input type="text" id="addPhone" placeholder="áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜">
        <button class="btn-gen" style="background:var(--blue);" onclick="addItem('staff')">+ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
        <div id="staffListUI"></div>
    </div>

    <div class="box">
        <h3>ğŸ“ áƒ¡áƒ”áƒ¥áƒªáƒ˜áƒ”áƒ‘áƒ˜</h3>
        <input type="text" id="regName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ’áƒ•áƒáƒ áƒ˜">
        <input type="text" id="regPhone" placeholder="áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
            <button class="btn-gen" style="background:var(--west); font-size: 9px;" onclick="addItem('west')">áƒ“áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜</button>
            <button class="btn-gen" style="background:var(--east); font-size: 9px;" onclick="addItem('east')">áƒáƒ¦áƒ›áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜</button>
            <button class="btn-gen" style="background:var(--cc); font-size: 9px; grid-column: span 2;" onclick="addItem('cc')">áƒ¥áƒáƒšáƒªáƒ”áƒœáƒ¢áƒ áƒ˜</button>
        </div>
    </div>
</div>

<div id="main">
    <div id="canvas">
        <div class="live-banner">
            <div id="liveDateDisplay" class="big-date">---</div>
            <div id="liveName" style="font-size:22px; font-weight:700; color:var(--blue);">- - -</div>
            <a id="livePhone" href="#" class="live-phone">---</a>
            <div id="liveBtns" style="margin-top:10px; display:flex; gap:10px; justify-content:center;">
                <a id="liveCall" href="#" class="btn-act" style="background:var(--green)">CALL</a>
                <a id="liveViber" href="#" class="btn-act" style="background:var(--viber)">VIBER</a>
            </div>
        </div>

        <div class="priority-box">
            <div id="pWestArea" class="p-card" style="background:var(--west)">áƒ“áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜</div>
            <div id="pEastArea" class="p-card" style="background:var(--east)">áƒáƒ¦áƒ›áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜</div>
            <div id="pCCArea" class="p-card" style="background:var(--cc)">áƒ¥áƒáƒšáƒªáƒ”áƒœáƒ¢áƒ áƒ˜</div>
        </div>

        <div id="customInfoDisplay"></div>
        <div id="scheduleBody"></div>
    </div>
    <button class="btn-export" onclick="exportFinal()">ğŸ“‹ áƒ¡áƒáƒ‘áƒáƒšáƒáƒ HTML-áƒ˜áƒ¡ áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>
</div>

<script>
    let staff = [], west = [], east = [], cc = [], schedule = [];
    const monthsGeo = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];
    const daysGeo = ["áƒ™áƒ•áƒ˜áƒ áƒ", "áƒáƒ áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒ¡áƒáƒ›áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒáƒ—áƒ®áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒ®áƒ£áƒ—áƒ¨áƒáƒ‘áƒáƒ—áƒ˜", "áƒáƒáƒ áƒáƒ¡áƒ™áƒ”áƒ•áƒ˜", "áƒ¨áƒáƒ‘áƒáƒ—áƒ˜"];

    window.onload = () => { document.getElementById('workMonth').value = new Date().toISOString().slice(0, 7); };

    function addItem(type) {
        let n = document.getElementById(type==='staff'?'addName':'regName'), p = document.getElementById(type==='staff'?'addPhone':'regPhone');
        if(!n.value || !p.value) return;
        let obj = { id: Date.now(), name: n.value, phone: p.value.replace(/\s/g,'') };
        if(type==='staff') staff.push(obj);
        else if(type==='west') west.push(obj);
        else if(type==='east') east.push(obj);
        else cc.push(obj);
        n.value = p.value = ""; render();
    }

    function smartDistribute() {
        const mVal = document.getElementById('workMonth').value;
        const sD = parseInt(document.getElementById('startDay').value);
        const eD = parseInt(document.getElementById('endDay').value);
        if(!mVal || staff.length === 0) return alert("áƒ“áƒáƒáƒ›áƒáƒ¢áƒ”áƒ— áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜!");
        schedule = [];
        let count = 0;
        for(let d = sD; d <= eD; d++) {
            schedule.push({ day: d, pid: staff[count % staff.length].id });
            count++;
        }
        render();
    }

    function render() {
        document.getElementById('staffListUI').innerHTML = staff.map((s, i) => `<div style="display:flex; justify-content:space-between; background:rgba(255,255,255,0.1); padding:5px; margin-bottom:5px; border-radius:5px;"><span>${s.name}</span><span style="color:red; cursor:pointer" onclick="staff.splice(${i},1);render()">Ã—</span></div>`).join('');
        
        const drawReg = (list, area, label, color) => {
            document.getElementById(area).innerHTML = `<small>${label}</small>` + list.map((a, i) => `<div><b>${a.name}</b><br><a href="tel:${a.phone}" style="color:white; text-decoration:none; font-size:10px;">${a.phone}</a> <span style="cursor:pointer" onclick="${area==='pWestArea'?'west':area==='pEastArea'?'east':'cc'}.splice(${i},1);render()">Ã—</span></div>`).join('');
        };
        drawReg(west, 'pWestArea', 'ğŸ”ï¸ áƒ“áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜');
        drawReg(east, 'pEastArea', 'â˜€ï¸ áƒáƒ¦áƒ›áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜');
        drawReg(cc, 'pCCArea', 'ğŸ“ áƒ¥áƒáƒšáƒªáƒ”áƒœáƒ¢áƒ áƒ˜');

        const mVal = document.getElementById('workMonth').value;
        if(mVal && schedule.length) {
            const [y, m] = mVal.split('-');
            document.getElementById('scheduleBody').innerHTML = schedule.map(item => {
                let p = staff.find(s => s.id === item.pid), dObj = new Date(y, m-1, item.day);
                let isToday = (new Date().getDate() === item.day && (new Date().getMonth()+1) === parseInt(m));
                return `<div class="row ${isToday ? 'today-row' : ''}">
                    <div><b>${item.day}</b> <small>${daysGeo[dObj.getDay()]}</small></div>
                    <div style="text-align:right">
                        <select class="sel-duty" onchange="const entry = schedule.find(s=>s.day===${item.day}); entry.pid=parseInt(this.value); updateLive();">${staff.map(st => `<option value="${st.id}" ${st.id === item.pid ? 'selected' : ''}>${st.name}</option>`).join('')}</select>
                        <div style="margin-top:5px;"><a href="tel:${p.phone}" class="btn-act" style="background:var(--green)">CALL</a><a href="viber://chat?number=%2B995${p.phone.slice(-9)}" class="btn-act" style="background:var(--viber); margin-left:5px;">V</a></div>
                    </div>
                </div>`;
            }).join('');
        }
        updateLive();
    }

    function updateLive() {
        const now = new Date();
        document.getElementById('liveDateDisplay').innerText = `${now.getDate()} ${monthsGeo[now.getMonth()]}`;
        const mVal = document.getElementById('workMonth').value;
        if(mVal && schedule.length) {
            const [y, m] = mVal.split('-');
            if(now.getFullYear() == y && (now.getMonth()+1) == m) {
                const entry = schedule.find(s => s.day == now.getDate());
                if(entry) {
                    const p = staff.find(s => s.id == entry.pid);
                    document.getElementById('liveName').innerText = p.name;
                    document.getElementById('livePhone').innerText = p.phone;
                    document.getElementById('liveCall').href = "tel:" + p.phone;
                    document.getElementById('liveViber').href = "viber://chat?number=%2B995" + p.phone.slice(-9);
                    return;
                }
            }
        }
        document.getElementById('liveName').innerText = "áƒ“áƒáƒ¡áƒ•áƒ”áƒœáƒ”áƒ‘áƒ";
    }
    setInterval(updateLive, 1000);

    function updateCustomInfo() {
        const div = document.getElementById('customInfoDisplay');
        const text = document.getElementById('infoText').value;
        if(text.trim()) { div.style.display = 'block'; div.innerText = text; div.style.color = document.getElementById('infoColor').value; }
        else div.style.display = 'none';
    }

    function exportFinal() {
        const [y, m] = document.getElementById('workMonth').value.split('-');
        const infoDiv = document.getElementById('customInfoDisplay');
        const customHTML = infoDiv.style.display === 'block' ? `<div style="background:#f8fafc; padding:20px; border-radius:20px; margin:20px 0; border-left:6px solid #0ea5e9; color:${infoDiv.style.color}; font-weight:700;">${infoDiv.innerText}</div>` : '';

        const finalCode = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body { font-family: system-ui, sans-serif; background: #f1f5f9; display: flex; justify-content: center; padding: 15px; margin: 0; }
    .card { max-width: 500px; width: 100%; background: white; border-radius: 35px; padding: 25px; box-shadow: 0 30px 60px rgba(0,0,0,0.1); }
    .top { background: #0f172a; color: white; padding: 25px; border-radius: 25px; text-align: center; }
    .ph { font-size: 32px; color: #16a34a; font-weight: 800; text-decoration: none; display: block; margin: 10px 0; }
    .pri { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin: 20px 0; }
    .p-c { padding: 12px; border-radius: 15px; color: white; text-align: center; font-size: 11px; }
    .r { padding: 15px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
    .act { background: #0ea5e9 !important; color: white !important; border-radius: 20px; }
    .act b, .act span { color: white !important; }
    .btn { text-decoration: none; color: white; padding: 6px 10px; border-radius: 8px; font-size: 10px; font-weight: 800; }
</style></head><body>
<div class="card">
    <div class="top">
        <div id="t_d" style="font-size:38px; font-weight:900; color:#0ea5e9">---</div>
        <div id="t_n" style="font-size:20px; font-weight:700;">-</div>
        <a id="t_p" class="ph" href="#">-</a>
        <div style="display:flex; gap:10px; justify-content:center;">
            <a id="c_b" href="#" class="btn" style="background:#16a34a">CALL</a>
            <a id="v_b" href="#" class="btn" style="background:#7360f2">VIBER</a>
        </div>
    </div>
    <div class="pri">
        <div class="p-c" style="background:#f59e0b">ğŸ”ï¸ áƒ“áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜<br>${west.map(a=>`<b>${a.name}</b>`).join('')}</div>
        <div class="p-c" style="background:#ea580c">â˜€ï¸ áƒáƒ¦áƒ›áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜<br>${east.map(a=>`<b>${a.name}</b>`).join('')}</div>
        <div class="p-c" style="background:#6366f1">ğŸ“ áƒ¥áƒáƒšáƒªáƒ”áƒœáƒ¢áƒ áƒ˜<br>${cc.map(a=>`<b>${a.name}</b>`).join('')}</div>
    </div>
    ${customHTML}
    ${schedule.map(item => {
        let p = staff.find(s => s.id === item.pid);
        return `<div class="r" data-d="${item.day}" data-n="${p.name}" data-p="${p.phone}">
            <div><b>${item.day} ${monthsGeo[parseInt(m)-1]}</b></div>
            <div style="text-align:right">
                <b>${p.name}</b><br><span style="font-size:12px; font-weight:800; color:#475569;">${p.phone}</span>
                <div style="margin-top:5px;"><a href="tel:${p.phone}" class="btn" style="background:#16a34a">CALL</a> <a href="viber://chat?number=%2B995${p.phone.slice(-9)}" class="btn" style="background:#7360f2">V</a></div>
            </div>
        </div>`;
    }).join('')}
</div>
<script>
    const tM = ${parseInt(m)-1}, tY = ${y}, mN = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];
    function tick() {
        const n=new Date(), d=n.getDate(), m=n.getMonth(), y=n.getFullYear();
        document.getElementById('t_d').innerText = d + " " + mN[m];
        document.querySelectorAll('.r').forEach(r => {
            if(r.dataset.d == d && m === tM && y === tY) { 
                r.classList.add('act');
                document.getElementById('t_n').innerText = r.dataset.n;
                document.getElementById('t_p').innerText = r.dataset.p;
                document.getElementById('t_p').href = "tel:" + r.dataset.p;
                document.getElementById('c_b').href = "tel:" + r.dataset.p;
                document.getElementById('v_b').href = "viber://chat?number=%2B995" + r.dataset.p.slice(-9);
            } else r.classList.remove('act');
        });
    } tick(); setInterval(tick, 1000);
<\/script></body></html>`;
        const el = document.createElement('textarea'); el.value = finalCode; document.body.appendChild(el); el.select();
        document.execCommand('copy'); document.body.removeChild(el);
        alert("âœ… áƒ™áƒáƒ“áƒ˜ áƒ›áƒ–áƒáƒ“áƒáƒ áƒ“áƒ áƒ“áƒáƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ!");
    }
</script>
</body>
</html>
