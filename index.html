<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <title>Duty Manager Pro - Regional Color Control</title>
    <style>
        :root { --dark: #0f172a; --blue: #38bdf8; --green: #16a34a; --viber: #7360f2; --bg: #f8fafc; --alert: #ef4444; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); overflow: hidden; }
        
        #sidebar { width: 380px; background: var(--dark); color: white; padding: 25px; overflow-y: auto; flex-shrink: 0; border-right: 1px solid rgba(255,255,255,0.1); }
        .box { background: rgba(255,255,255,0.07); padding: 18px; border-radius: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        h3 { color: var(--blue); font-size: 11px; text-transform: uppercase; margin: 0 0 15px 0; letter-spacing: 2px; font-weight: 800; }
        input, textarea, select { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 12px; border: none; font-weight: 700; box-sizing: border-box; font-size: 14px; }
        
        #main { flex-grow: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        #canvas { width: 100%; max-width: 720px; background: white; border-radius: 45px; padding: 35px; box-shadow: 0 30px 60px rgba(15, 23, 42, 0.15); }
        
        @keyframes pulse-border {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { transform: scale(1.01); box-shadow: 0 0 25px 10px rgba(239, 68, 68, 0.4); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .live-banner { 
            background: #0f172a; color: white; padding: 35px; border-radius: 35px; text-align: center; 
            margin-bottom: 25px; border: 5px solid var(--alert); animation: pulse-border 3s infinite ease-in-out;
        }
        .big-date { font-size: 48px; font-weight: 900; color: var(--blue); margin-bottom: 10px; }
        .live-name { font-size: 28px; font-weight: 800; margin-bottom: 5px; color: #fff; }
        
        .priority-box { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .p-card { padding: 15px; border-radius: 28px; color: white; text-align: center; min-height: 160px; display: flex; flex-direction: column; background: #475569; transition: background 0.3s; }
        .p-info { background: rgba(255,255,255,0.1); padding: 10px 5px; border-radius: 18px; margin-bottom: 8px; font-size: 13px; }
        
        .btn-m { text-decoration: none; padding: 5px 10px; border-radius: 10px; display: inline-flex; align-items: center; justify-content: center; margin: 2px; font-size: 10px; font-weight: 900; border: none; cursor: pointer; }
        .btn-call { background: var(--green) !important; color: white !important; }
        .btn-viber { background: var(--viber) !important; color: white !important; }
        
        .row { padding: 15px 20px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
        .today-row { background: #fef2f2; border-left: 8px solid var(--alert); border-radius: 0 20px 20px 0; }
        
        .btn-gen { background: #334155; color: white; width: 100%; padding: 12px; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; }
        .s-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.08); padding: 8px 12px; border-radius: 10px; margin-bottom: 5px; font-size: 11px; }
        .del { color: #ff4757; cursor: pointer; font-weight: bold; padding-left: 10px; }
        
        .color-ctrl { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; font-size: 12px; }
        .color-ctrl input { width: 50px; height: 30px; padding: 0; cursor: pointer; border: none; background: none; }
        
        .edit-select { width: 170px; font-size: 12px; padding: 5px; border-radius: 8px; border: 1px solid #cbd5e1; font-weight: 700; background: #fff; margin-bottom: 5px; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="box">
        <h3>ğŸ¨ áƒ“áƒ˜áƒ–áƒáƒ˜áƒœáƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h3>
        <div class="color-ctrl">áƒ‘áƒáƒœáƒ”áƒ áƒ˜áƒ¡ áƒ¤áƒáƒœáƒ˜ <input type="color" id="clrBg" value="#0f172a" oninput="updateUIStyles()"></div>
        <div class="color-ctrl">áƒ áƒ”áƒ’áƒ˜áƒáƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ¤áƒ”áƒ áƒ˜ <input type="color" id="clrReg" value="#475569" oninput="updateUIStyles()"></div>
        <div class="color-ctrl">áƒ™áƒáƒœáƒ¢áƒ˜áƒ¡ áƒ¤áƒ”áƒ áƒ˜ <input type="color" id="clrBorder" value="#ef4444" oninput="updateUIStyles()"></div>
        <div class="color-ctrl">áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜áƒ¡ áƒ¤áƒ”áƒ áƒ˜ <input type="color" id="clrText" value="#38bdf8" oninput="updateUIStyles()"></div>
        <div class="color-ctrl">áƒ¡áƒáƒ®áƒ”áƒšáƒ˜áƒ¡ áƒ¤áƒ”áƒ áƒ˜ <input type="color" id="clrName" value="#ffffff" oninput="updateUIStyles()"></div>
    </div>

    <div class="box">
        <h3>ğŸ“… áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ˜</h3>
        <input type="month" id="workMonth">
        <div style="display:flex; gap:10px;">
            <input type="number" id="rangeStart" value="1">
            <input type="number" id="rangeEnd" value="31">
        </div>
        <button class="btn-gen" style="background:var(--blue); color:#000" onclick="generateSchedule()">ğŸ”„ áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ</button>
    </div>

    <div class="box">
        <h3>ğŸ‘¥ áƒ›áƒáƒ áƒ˜áƒ’áƒ” áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜</h3>
        <input type="text" id="stName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ’áƒ•áƒáƒ áƒ˜">
        <input type="text" id="stPhone" placeholder="áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜">
        <button class="btn-gen" style="background:#6366f1" onclick="addItem('staff')">+ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
        <div id="staffListUI" style="margin-top:10px; max-height: 120px; overflow-y: auto;"></div>
    </div>

    <div class="box">
        <h3>ğŸ”ï¸ áƒ áƒ”áƒ’áƒ˜áƒáƒœáƒáƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h3>
        <select id="regType">
            <option value="west">áƒ“áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜</option>
            <option value="east">áƒáƒ¦áƒ›áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜</option>
        </select>
        <input type="text" id="regName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ’áƒ•áƒáƒ áƒ˜">
        <input type="text" id="regPhone" placeholder="áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜">
        <button class="btn-gen" onclick="addItem('regional')">+ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
        <div id="regListUI" style="margin-top:10px;"></div>
    </div>

    <div class="box">
        <h3>ğŸ“ áƒ¥áƒáƒšáƒªáƒ”áƒœáƒ¢áƒ áƒ˜ / áƒ¨áƒ”áƒœáƒ˜áƒ¨áƒ•áƒœáƒ</h3>
        <input type="text" id="ccNum" value="8888" oninput="render()">
        <textarea id="noteTxt" placeholder="áƒ¨áƒ”áƒœáƒ˜áƒ¨áƒ•áƒœáƒ..." oninput="render()"></textarea>
    </div>
</div>

<div id="main">
    <div id="canvas">
        <div id="liveBanner" class="live-banner">
            <div id="liveD" class="big-date">---</div>
            <div id="liveN" class="live-name">- - -</div>
            <a id="liveP" href="#" style="font-size:32px; color:var(--blue); font-weight:900; text-decoration:none; display:block; margin:10px 0;">---</a>
            <div style="display:flex; gap:15px; justify-content:center; margin-top:10px;">
                <a id="liveC" href="#" class="btn-m btn-call" style="width:120px; padding:12px;">ğŸ“ CALL</a>
                <a id="liveV" href="#" class="btn-m btn-viber" style="width:120px; padding:12px;">ğŸ’œ VIBER</a>
            </div>
        </div>

        <div class="priority-box">
            <div id="wBox" class="p-card"></div>
            <div id="eBox" class="p-card"></div>
            <div id="cBox" class="p-card" style="background:#334155;"></div>
        </div>

        <div id="noteBox" style="display:none; padding:20px; border-radius:25px; border-left:8px solid; margin-bottom:25px; background:#f1f5f9; font-weight:800; font-size:16px;"></div>
        <div id="scheduleBody"></div>
    </div>
    <button class="btn-gen" style="background:var(--green); width:720px; margin-top:20px; padding:18px; font-size:18px;" onclick="exportFinal()">ğŸ“‹ áƒ¡áƒáƒ‘áƒáƒšáƒáƒ HTML-áƒ˜áƒ¡ áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>
</div>

<script>
    let staff = [
        { name: "áƒ’áƒ˜áƒáƒ áƒ’áƒ˜ áƒšáƒáƒ›áƒ˜áƒ«áƒ”", phone: "555558222" },
        { name: "áƒ•áƒáƒ¡áƒ˜áƒš áƒ’áƒáƒ’áƒáƒšáƒáƒ«áƒ”", phone: "557949827" },
        { name: "áƒ¨áƒáƒšáƒ•áƒ áƒ’áƒáƒ’áƒœáƒ˜áƒ«áƒ”", phone: "551770200" }
    ];

    let west = [{name: "áƒ–áƒáƒáƒš áƒ’áƒ•áƒ”áƒ¢áƒáƒ«áƒ”", phone: "568230917"}];
    let east = [{name: "áƒ—áƒ”áƒ›áƒ áƒ’áƒ”áƒšáƒáƒ¨áƒ•áƒ˜áƒšáƒ˜", phone: "577698890"}];
    let schedule = [];
    const months = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];

    window.onload = () => {
        document.getElementById('workMonth').value = new Date().toISOString().slice(0, 7);
        render();
        updateUIStyles();
    };

    function updateUIStyles() {
        const bg = document.getElementById('clrBg').value;
        const regBg = document.getElementById('clrReg').value;
        const brd = document.getElementById('clrBorder').value;
        const txt = document.getElementById('clrText').value;
        const nme = document.getElementById('clrName').value;

        const banner = document.getElementById('liveBanner');
        banner.style.background = bg;
        banner.style.borderColor = brd;
        
        document.getElementById('wBox').style.background = regBg;
        document.getElementById('eBox').style.background = regBg;

        document.getElementById('liveD').style.color = txt;
        document.getElementById('liveP').style.color = txt;
        document.getElementById('liveN').style.color = nme;

        const styleId = 'dynamic-pulse-style';
        let styleTag = document.getElementById(styleId) || document.createElement('style');
        styleTag.id = styleId;
        styleTag.innerHTML = `@keyframes pulse-border { 
            0% { transform: scale(1); box-shadow: 0 0 0 0 ${brd}b3; } 
            50% { transform: scale(1.01); box-shadow: 0 0 25px 10px ${brd}66; } 
            100% { transform: scale(1); box-shadow: 0 0 0 0 ${brd}00; } 
        }`;
        document.head.appendChild(styleTag);
    }

    function addItem(type) {
        if(type === 'staff') {
            const n = document.getElementById('stName').value, p = document.getElementById('stPhone').value;
            if(n && p) { staff.push({name:n, phone:p}); document.getElementById('stName').value=''; document.getElementById('stPhone').value=''; }
        } else if(type === 'regional') {
            const n = document.getElementById('regName').value, p = document.getElementById('regPhone').value, r = document.getElementById('regType').value;
            if(n && p) {
                if(r === 'west') west.push({name:n, phone:p}); else east.push({name:n, phone:p});
                document.getElementById('regName').value=''; document.getElementById('regPhone').value='';
            }
        }
        render();
    }

    function generateSchedule() {
        const mVal = document.getElementById('workMonth').value;
        const s = parseInt(document.getElementById('rangeStart').value), e = parseInt(document.getElementById('rangeEnd').value);
        if(!mVal || !staff.length) return;
        schedule = [];
        for(let d = s; d <= e; d++) {
            schedule.push({ day: d, person: staff[(d-s) % staff.length] });
        }
        render();
    }

    function changeDuty(dayIdx, newName) {
        schedule[dayIdx].person = staff.find(p => p.name === newName);
        render();
    }

    function render() {
        document.getElementById('staffListUI').innerHTML = staff.map((s, i) => `<div class="s-item">${s.name} <span class="del" onclick="staff.splice(${i},1);render()">âœ•</span></div>`).join('');
        document.getElementById('regListUI').innerHTML = 
            west.map((s, i) => `<div class="s-item">áƒ“áƒáƒ¡: ${s.name} <span class="del" onclick="west.splice(${i},1);render()">âœ•</span></div>`).join('') +
            east.map((s, i) => `<div class="s-item">áƒáƒ¦áƒ›: ${s.name} <span class="del" onclick="east.splice(${i},1);render()">âœ•</span></div>`).join('');

        const getViberLink = (phone) => `viber://chat?number=%2B995${phone.replace(/\s+/g, '').slice(-9)}`;

        const drawP = (list, title) => `<small style="text-transform:uppercase; font-size:9px; display:block; margin-bottom:10px; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:5px; font-weight:800;">${title}</small>` + 
            list.map(p => `
                <div class="p-info">
                    <b>${p.name}</b><br>${p.phone}
                    <div style="margin-top:5px;">
                        <a href="tel:${p.phone}" class="btn-m btn-call">ğŸ“</a>
                        <a href="${getViberLink(p.phone)}" class="btn-m btn-viber">ğŸ’œ</a>
                    </div>
                </div>`).join('');

        document.getElementById('wBox').innerHTML = drawP(west, "áƒ“áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜áƒ¡ áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡áƒ›áƒ’áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒáƒ˜áƒ áƒ”áƒ‘áƒ˜");
        document.getElementById('eBox').innerHTML = drawP(east, "áƒáƒ¦áƒ›áƒáƒ¡áƒáƒ•áƒšáƒ”áƒ—áƒ˜áƒ¡ áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡áƒ›áƒ’áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒáƒ˜áƒ áƒ”áƒ‘áƒ˜");
        document.getElementById('cBox').innerHTML = `<small style="text-transform:uppercase; font-size:9px; font-weight:800;">ğŸ“ áƒ¥áƒáƒšáƒªáƒ”áƒœáƒ¢áƒ áƒ˜</small><b style="font-size:24px; margin:15px 0; display:block;">${document.getElementById('ccNum').value}</b><small>09:00 - 18:00</small>`;

        const nBox = document.getElementById('noteBox'), nTxt = document.getElementById('noteTxt').value;
        nBox.style.display = nTxt ? 'block' : 'none'; nBox.innerText = nTxt; nBox.style.borderColor = document.getElementById('clrBorder').value;

        const mVal = document.getElementById('workMonth').value;
        if(!mVal || !schedule.length) return;
        const year = parseInt(mVal.split('-')[0]), month = parseInt(mVal.split('-')[1])-1;
        const today = new Date().getDate(), currM = new Date().getMonth();

        document.getElementById('scheduleBody').innerHTML = schedule.map((item, idx) => {
            const dateObj = new Date(year, month, item.day);
            const hours = (dateObj.getDay() === 0 || dateObj.getDay() === 6) ? "06:00 - 06:00" : "18:00 - 06:00";
            let isToday = (item.day === today && month === currM);
            
            if(isToday) {
                document.getElementById('liveD').innerText = `${item.day} ${months[month]}`;
                document.getElementById('liveN').innerText = item.person.name;
                document.getElementById('liveP').innerText = item.person.phone;
                document.getElementById('liveP').href = "tel:"+item.person.phone;
                document.getElementById('liveC').href = "tel:"+item.person.phone;
                document.getElementById('liveV').href = getViberLink(item.person.phone);
            }

            return `<div class="row ${isToday ? 'today-row' : ''}">
                <div><b>${item.day} ${months[month]}</b><br><small style="font-size:11px; color:#64748b;">${hours}</small></div>
                <div style="text-align:right">
                    <select class="edit-select" onchange="changeDuty(${idx}, this.value)">
                        ${staff.map(s => `<option value="${s.name}" ${s.name === item.person.name ? 'selected' : ''}>${s.name}</option>`).join('')}
                    </select>
                    <div style="font-weight:900; color:#334155; font-size:14px; margin-bottom:5px;">${item.person.phone}</div>
                    <div style="display:flex; gap:3px; justify-content:flex-end;">
                        <a href="tel:${item.person.phone}" class="btn-m btn-call">ğŸ“ CALL</a>
                        <a href="${getViberLink(item.person.phone)}" class="btn-m btn-viber">ğŸ’œ VIBER</a>
                    </div>
                </div>
            </div>`;
        }).join('');
    }

    function exportFinal() {
        const canvas = document.getElementById('canvas').cloneNode(true);
        
        // áƒ¡áƒ”áƒšáƒ”áƒ¥áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒœáƒáƒªáƒ•áƒšáƒ”áƒ‘áƒ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜áƒ— áƒ“áƒ áƒ¡áƒáƒáƒ—áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒœáƒáƒ áƒ©áƒ£áƒœáƒ”áƒ‘áƒ
        canvas.querySelectorAll('.row').forEach(row => {
            const select = row.querySelector('.edit-select');
            if(select) {
                const nameText = select.value;
                select.outerHTML = `<b style="font-size:16px; display:block; color:#0f172a; margin-bottom:4px;">${nameText}</b>`;
            }
        });
        
        const brd = document.getElementById('clrBorder').value;
        const regBg = document.getElementById('clrReg').value;
        const bg = document.getElementById('clrBg').value;
        const txtColor = document.getElementById('clrText').value;
        const nameColor = document.getElementById('clrName').value;

        const finalHTML = `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>
            body{font-family:system-ui, -apple-system, sans-serif; background:#f8fafc; display:flex; justify-content:center; padding:20px;}
            #canvas{width:100%; max-width:720px; background:white; border-radius:45px; padding:35px; box-shadow:0 30px 60px rgba(0,0,0,0.1);}
            .live-banner{background:${bg}; color:white; border-radius:35px; text-align:center; padding:35px; margin-bottom:25px; border:5px solid ${brd}; animation: p 3s infinite ease-in-out;}
            @keyframes p { 0%{transform:scale(1); box-shadow:0 0 0 0 ${brd}b3;} 50%{transform:scale(1.01); box-shadow:0 0 20px 5px ${brd}66;} 100%{transform:scale(1);} }
            .big-date{font-size:48px; font-weight:900; color:${txtColor}; margin-bottom:10px;}
            .live-name{font-size:28px; font-weight:800; color:${nameColor};}
            .priority-box{display:grid; grid-template-columns:1fr 1fr 1fr; gap:15px; margin-bottom:20px;}
            .p-card{background:${regBg}; padding:15px; border-radius:28px; color:white; text-align:center; font-size:10px; min-height:160px;}
            .p-info{background:rgba(255,255,255,0.1); padding:10px 5px; border-radius:18px; margin-bottom:8px;}
            .row{padding:15px 20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;}
            .today-row{background: #fef2f2; border-left: 8px solid ${brd}; border-radius: 0 20px 20px 0;}
            .btn-m{text-decoration:none; padding:8px 15px; border-radius:10px; font-weight:800; display:inline-block; margin:2px; background:#16a34a; color:white; font-size:10px;}
            .btn-viber{background:#7360f2 !important;}
            #noteBox{border-left:8px solid ${brd} !important;}
        </style></head><body>${canvas.outerHTML}</body></html>`;
        
        const el = document.createElement('textarea'); el.value = finalHTML; document.body.appendChild(el); el.select();
        document.execCommand('copy'); document.body.removeChild(el);
        alert("âœ… áƒ™áƒáƒ“áƒ˜ áƒ“áƒáƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ! áƒ¡áƒáƒ›áƒ£áƒ¨áƒáƒ áƒ¡áƒáƒáƒ—áƒ”áƒ‘áƒ˜ (18:00-06:00 áƒ“áƒ 06:00-06:00) áƒ¨áƒ”áƒœáƒáƒ áƒ©áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜áƒ.");
    }
</script>
</body>
</html>
